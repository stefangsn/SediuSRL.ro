# =====================
# Securitate Generală
# =====================

# Obligă HTTPS
RewriteEngine On
RewriteCond %{HTTPS} !=on
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Dezactivează afișarea fișierelor din directoare
Options -Indexes

# Blochează accesul la fișiere sensibile
<FilesMatch "\.(htaccess|htpasswd|env|ini|log|bak|inc|sh|sql)$">
  Order Allow,Deny
  Deny from all
</FilesMatch>

# =====================
# Header-e de Securitate
# =====================

# XSS, Clickjacking, Sniffing, etc.
Header always set X-Frame-Options "SAMEORIGIN"
Header always set X-XSS-Protection "1; mode=block"
Header always set X-Content-Type-Options "nosniff"
Header always set Referrer-Policy "strict-origin-when-cross-origin"
Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"

# Strict Transport Security
Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"

# =====================
# Content Security Policy (CSP)
# =====================

# CSP de bază pentru site static (modifică în funcție de ce folosești!)
Header set Content-Security-Policy "default-src 'self'; \
script-src 'self' 'unsafe-inline' https://connect.facebook.net; \
img-src 'self' data: https://www.facebook.com https://connect.facebook.net; \
style-src 'self' 'unsafe-inline'; \
font-src 'self'; \
connect-src 'self' https://connect.facebook.net; \
frame-src https://www.facebook.com https://wa.me; \
frame-ancestors 'none'; \
base-uri 'self';"



# Explicație:
# - `default-src 'self'`: doar propriul domeniu
# - `img-src 'self' data:`: permite imagini locale și iconuri inline
# - `style-src 'self' 'unsafe-inline'`: permite CSS inline (necesar pt stiluri <style>)
# - `script-src 'self' 'unsafe-inline'`: necesar dacă ai JS inline în <script> (altfel scoate 'unsafe-inline')
# - `frame-ancestors 'none'`: previne embedding în iframe
# - `base-uri 'self'`: limitează <base href> modificat din JS

# =====================
# Cache Fișiere Statice
# =====================

<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access plus 1 month"
  ExpiresByType image/jpeg "access plus 1 month"
  ExpiresByType image/png "access plus 1 month"
  ExpiresByType image/webp "access plus 1 month"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType application/font-woff2 "access plus 1 year"
</IfModule>

<IfModule mod_headers.c>
  <FilesMatch "\.(jpg|jpeg|png|webp|css|js|woff2)$">
    Header set Cache-Control "public, max-age=2592000, immutable"
  </FilesMatch>
</IfModule>

# Eliminare .html din URL
RewriteEngine On
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteRule ^([^/]+)/?$ $1.html [L]
